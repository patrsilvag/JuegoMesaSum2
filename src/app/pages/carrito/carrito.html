<!-- Encabezado -->
<section class="bg-light border-bottom py-3">
  <div class="container">
    <h1 class="h4 mb-0">üõí Carrito de Compras</h1>
  </div>
</section>

<main class="container my-4">

  <!-- Carrito vac√≠o -->
  <div class="alert alert-info text-center" *ngIf="carritoLista.length === 0">
    Tu carrito est√° vac√≠o.
  </div>

  <!-- Carrito con productos -->
  <div class="row gy-4" *ngIf="carritoLista.length > 0">

    <!-- LISTA UNIFICADA (Mobile ‚Üí Cards / Desktop ‚Üí Tabla con Grid) -->
    <div class="col-12 col-lg-8">
      <div class="carrito-lista">
        
        <div class="carrito-item" *ngFor="let p of carritoLista">

          <!-- PRODUCTO -->
          <div class="col-producto">
            <img [src]="p.imagen" [alt]="p.nombre" />
            <span class="nombre">{{ p.nombre }}</span>
          </div>

          <!-- PRECIO -->
          <div class="col-precio">
            $ {{ p.precio | number }}
          </div>

          <!-- CANTIDAD -->
          <div class="col-cantidad">
            <button (click)="restar(p.id)">‚àí</button>
            <span>{{ p.cantidad }}</span>
            <button (click)="sumar(p.id)">+</button>
          </div>

          <!-- SUBTOTAL -->
          <div class="col-subtotal">
            $ {{ p.cantidad * p.precio | number }}
          </div>

          <!-- ACCIONES -->
          <div class="col-acciones">
            <button class="btn-eliminar" (click)="quitar(p.id)">
              Eliminar
            </button>
          </div>

        </div>

      </div>
    </div>

    <!-- RESUMEN + FORMULARIO REACTIVO -->
    <div class="col-12 col-lg-4">
      <form class="resumen-box" [formGroup]="cuponForm" (ngSubmit)="aplicarCupon()">

        <h3>Resumen</h3>

        <!-- SUBTOTAL ORIGINAL -->
        <div class="linea">
          <span>Subtotal:</span>
          <strong>$ {{ subtotalOriginal() | number }}</strong>
        </div>

        <!-- DESCUENTO -->
        <div class="linea" *ngIf="subtotalOriginal() !== total()">
          <span>Descuento:</span>
          <strong class="text-success">
            - $ {{ subtotalOriginal() - total() | number }}
          </strong>
        </div>

        <!-- SUBTOTAL CON DESCUENTO -->
        <div class="linea">
          <span>Subtotal con descuento:</span>
          <strong>$ {{ total() | number }}</strong>
        </div>

        <!-- ENV√çO -->
        <div class="linea">
          <span>Env√≠o:</span>
          <strong>$ {{ envio() | number }}</strong>
        </div>

        <hr />

        <!-- INPUT CUP√ìN -->
        <div>
          <input
            type="text"
            class="form-control"
            formControlName="codigoDescuento"
            placeholder="Ingresa tu cup√≥n"
          />
          <small class="text-danger"
            *ngIf="cuponForm.get('codigoDescuento')?.invalid && cuponForm.get('codigoDescuento')?.touched">
            Debe tener al menos 4 caracteres.
          </small>
        </div>

        <!-- BOTONES -->
        <div class="row g-2 mt-1">
          <div class="col-6">
            <button class="btn btn-primary w-100" type="submit" [disabled]="cuponForm.invalid">
              Aplicar
            </button>
          </div>
          <div class="col-6">
            <button class="btn btn-secondary w-100" type="button" (click)="limpiarCupon()">
              Limpiar
            </button>
          </div>
        </div>

        <!-- MENSAJE DEL CUP√ìN -->
        <div *ngIf="mensajeCupon" class="alert alert-info mt-2">
          {{ mensajeCupon }}
        </div>

        <hr />

        <!-- TOTAL FINAL -->
        <div class="linea total-final">
          <strong>Total:</strong>
          <strong>$ {{ totalFinal() | number }}</strong>
        </div>

        <!-- VACIAR -->
        <button class="btn-vaciar" type="button" (click)="limpiarCarrito()">
          Vaciar carrito
        </button>

      </form>
    </div>

  </div>

  <!-- Bot√≥n volver -->
  <div class="text-center mt-4">
    <a routerLink="/" class="btn btn-primary">
      ‚Üê Seguir comprando
    </a>
  </div>

</main>
