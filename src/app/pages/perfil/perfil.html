<section class="form-container">
  <h2 class="form-title">Mi Perfil</h2>

  <!-- ==========================
       DATOS PERSONALES
  =========================== -->
  <!-- ‚úÖ *ngIf en el MISMO form que usa [formGroup] -->
  <form *ngIf="formDatos" [formGroup]="formDatos" (ngSubmit)="guardarDatos()" novalidate>
    <div class="grid-2">
      <!-- NOMBRE -->
      <div class="form-group">
        <label>Nombre completo:</label>
        <input
          type="text"
          class="form-control"
          formControlName="nombre"
          placeholder="Ej: Juan P√©rez"
        />
        <small *ngIf="fcDatos('nombre').touched && fcDatos('nombre').invalid" class="error">
          Este campo es obligatorio.
        </small>
      </div>

      <!-- USUARIO -->
      <div class="form-group">
        <label>Nombre de usuario:</label>
        <input type="text" class="form-control" formControlName="usuario" />
        <small *ngIf="fcDatos('usuario').touched && fcDatos('usuario').invalid" class="error">
          Este campo es obligatorio.
        </small>
      </div>

      <!-- CORREO -->
      <div class="form-group">
        <label>Correo electr√≥nico:</label>
        <input type="email" class="form-control" formControlName="correo" />
      </div>

      <!-- FECHA NACIMIENTO -->
      <div class="form-group">
        <label>Fecha de nacimiento:</label>
        <input type="date" class="form-control" formControlName="fechaNacimiento" />

        <small
          *ngIf="
            fcDatos('fechaNacimiento').errors &&
            (fcDatos('fechaNacimiento').dirty || fcDatos('fechaNacimiento').touched)
          "
          class="error"
        >
          {{ getFechaError() }}
        </small>
      </div>

      <!-- DIRECCI√ìN -->
      <div class="form-group full">
        <label>Direcci√≥n:</label>
        <input
          type="text"
          class="form-control"
          formControlName="direccion"
          placeholder="Ej: Av. Siempre Viva 123"
        />
      </div>
    </div>

    <button type="submit" class="btn-primary mt-3">Guardar cambios</button>
  </form>

  <hr class="my-4" />

  <!-- ==========================
       CAMBIAR CONTRASE√ëA
  =========================== -->
  <h3 class="form-title" style="font-size: 1.3rem">Cambiar contrase√±a</h3>

  <!-- ‚úÖ *ngIf en el MISMO form que usa [formGroup] -->
  <form *ngIf="formClave" [formGroup]="formClave" (ngSubmit)="actualizarClave()" novalidate>
    <div class="grid-2">
      <!-- CLAVE ACTUAL -->
      <div class="form-group">
        <label>Contrase√±a actual:</label>
        <div class="password-group">
          <input
            [type]="verActual ? 'text' : 'password'"
            class="form-control"
            formControlName="claveActual"
          />
          <button type="button" class="btn-ojo" (click)="verActual = !verActual">üëÅÔ∏è</button>
        </div>
        <small
          *ngIf="fcClave('claveActual').touched && fcClave('claveActual').errors?.['incorrecta']"
          class="error"
        >
          {{ fcClave('claveActual').errors?.['incorrecta'] }}
        </small>
      </div>

      <!-- NUEVA CLAVE -->
      <div class="form-group">
        <label>Nueva contrase√±a:</label>
        <div class="password-group">
          <input
            [type]="verNueva ? 'text' : 'password'"
            class="form-control"
            formControlName="nuevaClave"
          />
          <button type="button" class="btn-ojo" (click)="verNueva = !verNueva">üëÅÔ∏è</button>
        </div>

        <div class="reglas" *ngIf="fcClave('nuevaClave').touched">
          <span [class.ok]="!fcClave('nuevaClave').errors?.['minlength']">M√≠n. 6</span>
          <span [class.ok]="!fcClave('nuevaClave').errors?.['maxlength']">M√°x. 18</span>
          <span [class.ok]="!fcClave('nuevaClave').errors?.['uppercase']">May√∫scula</span>
          <span [class.ok]="!fcClave('nuevaClave').errors?.['number']">N√∫mero</span>
        </div>
      </div>

      <!-- REPETIR CLAVE -->
      <div class="form-group full">
        <label>Repetir nueva contrase√±a:</label>
        <div class="password-group">
          <input
            [type]="verRepetir ? 'text' : 'password'"
            class="form-control"
            formControlName="repetirClave"
          />
          <button type="button" class="btn-ojo" (click)="verRepetir = !verRepetir">üëÅÔ∏è</button>
        </div>
        <small
          *ngIf="formClave.errors?.['noCoinciden'] && fcClave('repetirClave').touched"
          class="error"
        >
          {{ formClave.errors?.['noCoinciden'] }}
        </small>
      </div>
    </div>

    <button type="submit" class="btn-primary mt-3">Actualizar contrase√±a</button>
  </form>

  <!-- ‚úÖ fallback si no hay forms -->
  <div *ngIf="!formDatos || !formClave" class="alert alert-warning text-center mt-3">
    No hay un usuario activo. Inicia sesi√≥n para ver tu perfil.
  </div>
</section>
