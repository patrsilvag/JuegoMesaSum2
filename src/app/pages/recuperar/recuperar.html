<section class="form-container">
  <div class="container recuperar-container">
    <!-- ============================
       PASO 1 ‚Äî INGRESAR CORREO
  ============================= -->
    <div *ngIf="paso === 1" class="form-block">
      <h2 class="text-center mb-3">Recuperar contrase√±a</h2>

      <form [formGroup]="formCorreo" novalidate>
        <label>Correo electr√≥nico</label>
        <input type="email" class="form-control" formControlName="correo" />

        <small
          *ngIf="
        formCorreo.get('correo')?.invalid &&
        (formCorreo.get('correo')?.dirty || formCorreo.get('correo')?.touched) &&
        !formCorreo.get('correo')?.errors?.['noExiste']"
          class="error"
        >
          Debes ingresar un correo v√°lido.
        </small>

        <small
          *ngIf="formCorreo.get('correo')?.errors?.['noExiste'] && 
           (formCorreo.get('correo')?.dirty || formCorreo.get('correo')?.touched)"
          class="error"
        >
          El correo no est√° registrado.
        </small>

        <button type="button" class="btn-primary mt-3" (click)="enviarCorreo()">
          Enviar c√≥digo
        </button>
      </form>
    </div>

    <!-- ============================
       PASO 2 ‚Äî VALIDAR C√ìDIGO
  ============================= -->
    <div *ngIf="paso === 2" class="form-block">
      <h2 class="text-center mb-3">Verifica tu c√≥digo</h2>

      <p class="text-center">
        Ingresa el c√≥digo enviado a: <strong>{{ correoValidado }}</strong>
      </p>

      <form [formGroup]="formCodigo" novalidate>
        <label>C√≥digo</label>
        <input type="text" class="form-control" formControlName="codigo" />

        <small
          *ngIf="
            formCodigo.get('codigo')?.errors &&
            (formCodigo.get('codigo')?.dirty || formCodigo.get('codigo')?.touched)
          "
          class="error"
        >
          <span *ngIf="formCodigo.get('codigo')?.errors?.['required']">
            Debes ingresar el c√≥digo.
          </span>

          <span *ngIf="formCodigo.get('codigo')?.errors?.['pattern']">
            Solo se permiten n√∫meros.
          </span>

          <span *ngIf="formCodigo.get('codigo')?.errors?.['minlength']">
            El c√≥digo debe tener 6 d√≠gitos.
          </span>

          <span *ngIf="formCodigo.get('codigo')?.errors?.['maxlength']">
            El c√≥digo debe tener 6 d√≠gitos.
          </span>
        </small>
        <small *ngIf="formCodigo.errors?.['incorrecto']" class="error">
          {{ formCodigo.errors?.['incorrecto'] }}
        </small>
        <button type="button" class="btn-primary mt-3" (click)="verificarCodigo()">
          Validar c√≥digo
        </button>

        <p class="mt-3 text-center">
          <a style="cursor: pointer" (click)="paso = 1">‚Üê Cambiar correo</a>
        </p>
      </form>
    </div>

    <!-- ============================
     PASO 3 ‚Äî NUEVA CONTRASE√ëA
============================= -->
    <div *ngIf="paso === 3" class="form-block">
      <h2 class="text-center mb-3">Nueva contrase√±a</h2>

      <form [formGroup]="formClave" novalidate>
        <!-- NUEVA CLAVE -->
        <label>Nueva contrase√±a</label>
        <div class="password-group">
          <input
            [type]="verClave ? 'text' : 'password'"
            class="form-control"
            formControlName="clave"
          />
          <button type="button" class="btn-ojo" (click)="verClave = !verClave">üëÅÔ∏è</button>
        </div>

        <!-- ERRORES DE LA NUEVA CLAVE -->
        ...
        <div class="reglas" *ngIf="formClave.get('clave')?.touched">
          <span [class.ok]="!formClave.get('clave')?.errors?.['minlength']">M√≠n. 6</span>
          <span [class.ok]="!formClave.get('clave')?.errors?.['maxlength']">M√°x. 18</span>
          <span [class.ok]="!formClave.get('clave')?.errors?.['uppercase']">May√∫scula</span>
          <span [class.ok]="!formClave.get('clave')?.errors?.['number']">N√∫mero</span>
        </div>
        ...

        <!-- REPETIR CLAVE -->
        <label class="mt-2">Repetir contrase√±a</label>
        <div class="password-group">
          <input
            [type]="verClave2 ? 'text' : 'password'"
            class="form-control"
            formControlName="clave2"
          />
          <button type="button" class="btn-ojo" (click)="verClave2 = !verClave2">üëÅÔ∏è</button>
        </div>

        <!-- ERROR: CONTRASE√ëAS NO COINCIDEN -->
        <small
          *ngIf="formClave.errors?.['noCoinciden'] && formClave.get('clave2')?.touched"
          class="error"
        >
          {{ formClave.errors?.['noCoinciden'] }}
        </small>

        <small *ngIf="formClave.errors?.['error']" class="error">
          {{ formClave.errors?.['error'] }}
        </small>

        <button type="button" class="btn-primary mt-3" (click)="actualizarClave()">
          Guardar nueva contrase√±a
        </button>

        <p class="mt-3 text-center">
          <a style="cursor: pointer" (click)="paso = 2">‚Üê Volver</a>
        </p>
      </form>
    </div>
  </div>
</section>
